

---

## 版本 4.0.2（2025-12-30）

---

### DNS 与路由系统

* 新增 DNS 配置能力

  * 支持自定义 DNS 服务器
  * 支持静态 Hosts 配置
* 修复 DNS 规则不生效的问题
* 新增 DNS 劫持路由
* 调整路由与策略参数

  * `policy.levels` 默认值改为 **0**
  * 优化部分路由与代理相关参数
* 出站结构调整

  * `confdir` 新增出站文件：`Direct` / `Block` / `DNS-Out`
  * 删除默认配置中的 `Direct`、`Block` 出站
  * URL2JSON 节点转换中移除 `Direct`、`Block` 相关内容

---

### 核心性能与状态检测

* 优化 Xray 运行状态与运行时统计

  * 使用 `/proc` 获取 Xray 运行时间
  * 替代 `ps / grep` 实现，提升 Android 兼容性
  * 显著减少 `fork` 次数，降低 CPU 与 IO 开销
* 内存使用统计优化

  * 改为读取 `/proc/<pid>/status` 中的 `VmRSS`
* 网络速率统计优化

  * 移除 1 秒阻塞延迟
  * 使用服务端差值计算
  * 首页加载时间提升约 **1 秒**

---

### 配置页性能与结构重构

* 配置页加载性能大幅提升

  * Shell 层一次性获取配置目录结构
  * 批量读取配置信息，减少重复调用
  * 数据缓存避免重复加载
* 渐进式与懒加载

  * 分组展开才加载数据
  * 节点列表支持滚动懒加载（IntersectionObserver）
  * 按块加载，避免重复请求
* 配置页布局重构

  * 改为横向标签页（`mdui-tabs`）
  * 标签栏支持横向滚动
  * 订阅分组操作按钮移入标签页面板
  * Tabs 适配 Monet 取色方案

---

### WebUI 交互与体验优化

* 页面切换体验优化

  * 所有页面统一延迟 200ms 切换
  * 等待导航动画完成后再更新页面内容
* 应用代理页面重构

  * 支持多用户
  * 支持显示系统应用
  * 支持关闭分应用代理设置
* 节点管理能力增强

  * 新增节点批量操作工具栏
  * 支持全部测试 / 按延迟排序 / 清理无效节点
  * 支持并行延迟测试并缓存结果
* 清理调试输出

  * 删除 62 处 `console.log`

---

### 应用与系统信息获取优化

* 移除 WebUI X 相关兼容代码

  * 统一使用 KernelSU API 获取应用信息
  * 应用图标统一使用 `ksu://icon/<packageName>`
* 应用信息获取稳定性增强

  * 内置重试机制（最多 10 次）
  * 修复首次加载应用信息失败的问题
* 用户空间显示优化

  * 显示格式调整为：`应用名 [用户 999]`
  * 描述栏仅显示包名

---

### 订阅与节点解析修复

* 修复订阅解析失败问题

  * 添加浏览器 User-Agent，绕过 Cloudflare 简单检测
  * 新增订阅调试日志 `logs/subscription.log`
* 节点解析能力增强

  * `xhttp` 传输类型支持 TLS
  * 支持自定义 headers 与 `xmux` 参数
* 修复订阅更新与删除参数错误的问题

---

### 样式与文案优化

* 导航与文案调整

  * 配置 → **节点**
  * 代理 → **应用**
  * 更新节点页标题与空状态提示
* 节点列表布局优化

  * 移除多余左侧 padding
  * 优化节点名称对齐方式，符合 Material Design
* 选择器样式优化

  * 使用 Monet 终极配色方案
  * 统一主色 / 自定义色 / 表面容器色
  * 修复 CSS 注释格式问题

---
